
(function(){var __hasProp=Object.prototype.hasOwnProperty;window.SmartTemplate=(function(){function SmartTemplate(name,options){this.name=name;this.options=options;this.templateHtml=(this.options!=null)&&this.options.hasOwnProperty('templateHtml')?this.options.templateHtml:$('.'+this.name+'.template');$('.template').hide();this.fallbackIDNumber=-1;}
SmartTemplate.prototype.add=function(itemOrCollection){var item,_i,_len,_results;if(itemOrCollection instanceof Array){_results=[];for(_i=0,_len=itemOrCollection.length;_i<_len;_i++){item=itemOrCollection[_i];_results.push(this.addItem(item));}
return _results;}else{return this.addItem(itemOrCollection);}};SmartTemplate.prototype.addItem=function(data,isUpdate){var htmlToRemove,instance,key,matchedElement,oldValues,regex,result,unevaledValue,value,_i,_j,_len,_len2,_ref,_ref2;instance=this.templateHtml.clone(false);if((this.options!=null)&&this.options.hasOwnProperty('bindDataToCssClasses')&&(this.options.bindDataToCssClasses!=null)){for(key in data){if(!__hasProp.call(data,key))continue;value=data[key];if(instance.find('.'+key)!=null){instance.find('.'+key).text(value);}}}
instance.attr('id',this.name+'_'+(data['id']||data['_id']||(this.fallbackIDNumber+=1)));_ref=[/\{{(.*?)\}}/g,/\%7B%7B(.*?)\%7D%7D/g];for(_i=0,_len=_ref.length;_i<_len;_i++){regex=_ref[_i];if(instance.html().match(new RegExp(regex))!==null){_ref2=instance.html().match(new RegExp(regex));for(_j=0,_len2=_ref2.length;_j<_len2;_j++){matchedElement=_ref2[_j];unevaledValue=matchedElement.replace('{{','').replace('}}','').replace('%7B%7B','').replace('%7D%7D','');value=(function(){if(data.hasOwnProperty(unevaledValue)){return data[unevaledValue];}else{if(unevaledValue.slice(0,3)==='if '){this.condition=eval(unevaledValue.replace('if ',''));if(this.condition===false){this.doNotevaluateRegexes=true;return'HtmlToRemove';}else{return'';}}else if(unevaledValue==='else'){if(this.condition===true){this.doNotevaluateRegexes=true;return'HtmlToRemove';}else{this.doNotevaluateRegexes=void 0;return'HtmlToKeep';}}else if(unevaledValue==='/if'){this.doNotevaluateRegexes=void 0;this.condition=void 0;return'/END';}else{if(this.doNotevaluateRegexes&&this.doNotevaluateRegexes===true){return'';}else{oldValues={};for(key in data){if(!__hasProp.call(data,key))continue;value=data[key];oldValues[key]=window[key];}
for(key in data){if(!__hasProp.call(data,key))continue;value=data[key];window[key]=value;}
result=eval(unevaledValue);for(key in oldValues){if(!__hasProp.call(oldValues,key))continue;value=oldValues[key];window[key]=value;}
return result;}}}}).call(this);instance.html(instance.html().replace(matchedElement,value));}}
if(instance.html().match('HtmlToRemove')){if(instance.html().match('HtmlToKeep')){htmlToRemove=instance.html().split('HtmlToRemove')[1].split('HtmlToKeep')[0];}else{htmlToRemove=instance.html().split('HtmlToRemove')[1].split('/END')[0];}
instance.html(instance.html().replace(htmlToRemove,'').replace('HtmlToRemove','').replace('HtmlToKeep','').replace('/END',''));}else{instance.html(instance.html().replace('/END',''));}}
if((this.options!=null)&&this.options.hasOwnProperty('cssStyleProperties')){instance.css(this.options.cssStyleProperties);}
instance.removeClass('template');if(!(isUpdate!=null)){if((this.options!=null)&&this.options.hasOwnProperty('beforeAdd')){this.options.beforeAdd(instance);}
if(!(this.options&&this.options.hasOwnProperty('prependTo'))){if(this.options&&this.options.hasOwnProperty('appendTo')){instance.appendTo(this.options.appendTo);}else{instance.appendTo(this.templateHtml.parent());}}else{instance.prependTo(this.options.prependTo);}
if((this.options!=null)&&this.options.hasOwnProperty('afterAdd')){this.options.afterAdd(instance);}}
instance.show();return instance;};SmartTemplate.prototype.remove=function(id){var instance;instance=this.findInstance(id,true);if(this.options.hasOwnProperty('beforeRemove')){this.options.beforeRemove(instance);}
instance.remove();if(this.options.hasOwnProperty('afterRemove')){return this.options.afterRemove(instance);}};SmartTemplate.prototype.update=function(data){var instance;instance=this.findInstance(data.id||data._id,true);if(this.options.hasOwnProperty('beforeUpdate')){this.options.beforeUpdate(instance);}
instance.html(this.addItem(data,true).html());if(this.options.hasOwnProperty('afterUpdate')){return this.options.afterUpdate(obj);}};SmartTemplate.prototype.clear=function(){var instance,_i,_len,_ref,_results;_ref=this.findWithOrWithoutContainer('.'+this.name,true);_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){instance=_ref[_i];_results.push(!$(instance).hasClass('template')?$(instance).remove():void 0);}
return _results;};SmartTemplate.prototype.refresh=function(data){this.clear();return this.add(data);};SmartTemplate.prototype.findInstance=function(id,withScope){if(withScope===void 0){withScope=false;}
if(((""+id).match(this.name))!=null){if(((""+id).match('#'))!=null){return this.findWithOrWithoutContainer(id,withScope);}else{return this.findWithOrWithoutContainer('#'+id,withScope);}}else{return this.findWithOrWithoutContainer('#'+this.name+'_'+id,withScope);}};SmartTemplate.prototype.findWithOrWithoutContainer=function(domElementIdentifier,withScope){if(this.options.hasOwnProperty('bindToContainer')&&withScope){return $($.find("#"+(this.options.bindToContainer.attr('id'))+" "+domElementIdentifier));}else{return $($.find(""+domElementIdentifier));}};return SmartTemplate;})();}).call(this);
